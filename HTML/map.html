<loadingscreen ng-if="!loadComplete" error="errorContext"></loadingscreen>
<div ng-if="loadComplete" layout="row" layout-fill style="overflow: hidden;">
    <!--Toolbar-->
    <div id="divToolbar" layout="column" layout-align="space-between center" class="verticalPadding toolbarColor" style="width: 55px; height: 100%;">
        <div>
            <md-button id="btnShowSideNav" class="md-icon-button" ng-class="{'toolbarButtonColor': displayUnits}" ng-click="displayUnits = !displayUnits; displayTile = false; displayDice = false;">
                <i class="fa fa-bars fa-lg" aria-hidden="true"><md-tooltip md-direction="right">Unit Info</md-tooltip></i>
            </md-button>
            <md-button id="btnShowTileInfo" class="md-icon-button" ng-class="{'toolbarButtonColor': displayTile}" ng-click="displayTile = !displayTile; displayUnits = false; displayDice = false;">
                <i class="fa fa-square-o fa-lg" aria-hidden="true"><md-tooltip md-direction="right">Tile Info</md-tooltip></i>
            </md-button>
        </div>
        <div>
            <md-button id="btnShowDiceRoll" class="md-icon-button" ng-class="{'toolbarButtonColor': displayDice}" ng-click="displayDice = !displayDice; displayUnits = false; displayTile = false;">
                <span class="material-symbols-rounded">casino</span>
                <md-tooltip md-direction="right">Dice Roller</md-tooltip>
            </md-button>
            <linksmenu workbookid="data.workbookID" chapterposturl="data.map.chapterPostURL" showconvoy="data.showConvoyLink" showshop="data.showShopLink" showmap="false" showanalyzer="true" />
        </div>
    </div>
    <!-- Search and unit display -->
    <div id="divUnitDisplay" ng-show="displayUnits" layout="column" class="verticalPadding horizontalPadding slide" style="width: 375px; height: 100%;">
        <!-- Search field -->
        <md-autocomplete
                id="mdAutoComplete"
                md-selected-item="search.selected"
                md-search-text="search.query"
                md-items="unit in unitsQuery(search.query) | orderBy: [unitSort, 'name']"
                md-item-text="unit.name"
                md-dropdown-items="5"
                md-min-length="0"
                md-escape-options="clear"
                md-no-cache="true"
                placeholder="Unit Name">
            <md-item-template>
                <div layout="row" layout-align="space-between center">
                    <span md-highlight-text="search.query" md-highlight-flags="i">{{unit.name}}</span>
                    <div layout="row">
                        <i ng-if="unit.location.pairedUnit.length > 0" class="fa fa-user-plus fa-lg fa-fw" aria-hidden="true"><md-tooltip md-direction="top">Paired</md-tooltip></i>
                        <i ng-if="unit.location.coordinate.asText.length == 0" class="fa fa-eye-slash fa-lg fa-fw" aria-hidden="true"><md-tooltip md-direction="top">Hidden</md-tooltip></i>
                        <i ng-if="unit.pinned" class="fa fa-thumb-tack fa-lg fa-fw fa-rotate-45" aria-hidden="true"><md-tooltip md-direction="top">Pinned</md-tooltip></i>
                    </div>
                </div>
            </md-item-template>
        </md-autocomplete>
        <!--Pinned Units List-->
        <div ng-if="numOfPinnedUnits > 0" layout="row" layout-align="space-between" class="topMargin">
            <div layout="column" flex>
                <div layout="row" class="halfBottomMargin leftPadding rem0_9Text opacity50">
                    Pinned Units
                </div>
                <div layout="row" layout-wrap>
                    <div ng-repeat="unit in getPinnedUnitsList() | orderBy: 'name'" class="md-chip-custom-jumbo" style="width: 44%;">
                        <div layout="row" layout-align="space-between center" class="clickable">
                            <div ng-click="search.selected = unit" layout="column" flex style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="{{unit.name}}">
                                {{unit.name}}
                            </div>
                            <div ng-click="pinButton_OnClick(unit)" layout="column" layout-align="center end" flex="25" title="Unpin unit">
                                <i class="fa fa-times fa-fw" aria-hidden="true"></i>
                            </div>
                        </div>  
                    </div>
                </div>
            </div>
            <div layout="column">
                <md-menu>
                    <md-button ng-click="$mdMenu.open($event)" class="md-icon-button" aria-label="Unpin Actions">
                        <i class="fa fa-ellipsis-v fa-lg" aria-hidden="true"><md-tooltip md-direction="right">Unpin Actions</md-tooltip></i>
                    </md-button>
                    <md-menu-content>
                      <md-menu-item>
                        <md-button ng-disabled="numOfPinnedUnits < 2 || !search.selected.pinned" ng-click="clearPinnedUnitsList(false)">Unpin all except current unit</md-button>
                      </md-menu-item>
                      <md-menu-item>
                        <md-button ng-click="clearPinnedUnitsList(true)">Unpin all units</md-button>
                      </md-menu-item>
                    </md-menu-content>
                  </md-menu>
            </div>
        </div>
        <md-divider ng-if="numOfPinnedUnits > 0" style="margin-top: 4px;"></md-divider>
        <!--Unit display-->
        <md-content ng-if="search.selected" layout-padding>
            <!-- Sprite, name, & pin icon -->
            <div layout="row" layout-align="space-between">
                <div layout="column">
                    <div layout="row" class="halfBottomMargin">
                        <img ng-src="{{search.selected.sprite.portraitURL.length > 0 ? search.selected.sprite.portraitURL : search.selected.sprite.spriteURL}}" ng-class="{'smooth' : search.selected.sprite.portraitURL.length > 0, 'flipHorizontal' : search.selected.sprite.portraitURL.length == 0 && data.system.affiliations[search.selected.affiliation].flipUnitSprites}" style="max-width: 275px; max-height: 200px;"/>
                    </div>
                    <div layout="row">
                        <div layout="column" class="rem1_4Text boldText">
                            <i class="fa fa-caret-down fa-fw clickable" ng-class="{'fa-rotate-270': !unitInfoExpanded}" ng-click="unitInfoExpanded = !unitInfoExpanded" aria-hidden="true"></i>
                        </div>
                        <div ng-if="data.system.affiliations[search.selected.affiliation].spriteURL.length > 0" layout="column" layout-align="start center" style="margin-right: 4px;">
                            <img ng-src="{{data.system.affiliations[search.selected.affiliation].spriteURL}}" style="max-height: 48px; max-width: 36px;"/>
                        </div>
                        <div layout="column">
                            <div layout="row" class="rem1_4Text boldText">{{search.selected.name}}</div>
                            <div layout="row" class="rem0_9Text leftPadding">Lvl. {{search.selected.stats.level}} {{search.selected.classes[0]}}</div>
                        </div>
                    </div>
                </div>
                <div layout="column">
                    <i ng-click="pinButton_OnClick(search.selected)" ng-class="{'opacity50': !search.selected.pinned}" class="fa fa-thumb-tack fa-lg fa-rotate-45 clickable" aria-hidden="true">
                        <md-tooltip md-direction="left">{{search.selected.pinned ? 'Unpin' : 'Pin'}} unit</md-tooltip>
                    </i>
                </div>
            </div>
            <!--Expanded unit info-->
            <div layout="column" ng-if="unitInfoExpanded">
                <div ng-if="search.selected.textFields.length > 0" ng-repeat="text in search.selected.textFields track by $index" layout="row" class="rem0_9Text bottomMargin">
                    {{text}}
                </div>
                <div ng-if="search.selected.player.length > 0" layout="row" class="rem0_9Text bottomMargin">
                    <b>Player</b>: {{search.selected.player}}
                </div>
                <div ng-if="search.selected.characterApplicationURL.length > 0" layout="row" class="rem0_9Text bottomMargin">
                    <b>Character Application</b>:&nbsp;<span ng-click="launchCharacterApplication(search.selected.characterApplicationURL)" class="hyperlinkText">Link <i class="fa fa-external-link" aria-hidden="true"></i></span>
                </div>
                <!--Movement Type-->
                <div ng-if="search.selected.movementType.length > 0" layout="row" class="rem0_9Text bottomMargin">
                    <b>Movement Type</b>: {{search.selected.movementType}}
                </div>
                <!--Classes-->
                <div ng-if="search.selected.classes.length > 0" 
                     ng-repeat="class in search.selected.classes track by class"
                     ng-init="classData = data.system.classes[class]"
                     layout="column" 
                     class="bottomMargin">
                    <div layout="row" class="rem0_9Text">
                        <b>{{data.system.interfaceLabels.class}}</b>: {{class}}
                    </div>
                    <div layout="row" ng-repeat="text in classData.textFields track by $index" class="rem0_8Text leftPadding" ng-class="{'bottomMargin': !$last}">
                        {{text}}
                    </div>
                </div>
                <!--Battle Style-->
                <battlestyle ng-if="search.selected.battleStyle.length > 0" 
                    battlestyle="search.selected.battleStyle" 
                    sysdata="data.system.battleStyles[search.selected.battleStyle]"
                    label="data.system.interfaceLabels.battleStyle"></battlestyle>
                <!--Affiliation-->
                <div layout="column">
                    <div layout="row" class="rem0_9Text">
                        <b>Affiliation</b>: {{search.selected.affiliation}}
                    </div>
                    <div layout="row" ng-repeat="text in data.system.affiliations[search.selected.affiliation].textFields track by $index" class="rem0_8Text leftPadding" ng-class="{'bottomMargin': !$last}">
                        {{text}}
                    </div>
                </div>      
            </div>
            <md-divider ng-if="unitInfoExpanded"></md-divider>
            <div layout="row" layout-wrap>
                <!--HP-->
                <div layout="column" flex="50" class="horizontalPadding halfBottomMargin">
                    <div layout="row" layout-align="space-between top">
                        <span>HP</span>
                        <span>
                            <span>{{search.selected.stats.hp.current}} / </span>
                            <span class="rem0_8Text">{{search.selected.stats.hp.maximum}}</span>
                        </span>
                    </div>
                    <div style="height: 6px;">
                        <unithealthbar hppercentage="search.selected.stats.hp.percentage" fallbackwidth="142" fallbackheight="6" style="width: 142px; height: 6px;"/>
                    </div>
                    <div ng-if="search.selected.stats.hp.remainingBars > 0" class="rem0_7Text" layout="row" layout-align="end">
                        +{{search.selected.stats.hp.remainingBars}} Bars Remaining
                    </div>
                </div>
                <!--Exp-->
                <div ng-if="search.selected.stats.experience > -1" layout="row" layout-align="space-between" flex="50" class="horizontalPadding">
                    <span>Exp</span>
                    <span>{{search.selected.stats.experience}}</span>
                </div>
                <!--Currency-->
                <div ng-if="search.selected.stats.heldCurrency > 0" layout="row" layout-align="space-between" flex="50" class="horizontalPadding">
                    <span>Money</span>
                    <currency amount="search.selected.stats.heldCurrency" format="data.system.constants.currency"></currency>
                </div>
            </div>
            <!--Pair-Up Info-->
            <div ng-if="search.selected.location.pairedUnit.length > 0" layout="row" layout-align="left" class="rem0_9Text">
                <div layout="column">
                    <i class="fa fa-user-plus fa-fw" aria-hidden="true" style="margin-right: 4px;"><md-tooltip md-direction="top">Unit Pair-Up</md-tooltip></i>
                </div>
                <div>
                    Paired with
                    <span ng-click="search.selected = getUnitByName(search.selected.location.pairedUnit)" class="hyperlinkText">{{search.selected.location.pairedUnit}}</span>
                    ({{search.selected.location.isBackOfPair ? 'back' : 'front'}})
                </div>
            </div>
            <!--Tags-->
            <div layout="row" ng-if="search.selected.tags.length > 0">
                <div layout="column" style="margin-right: 4px; padding-top: 5px;">
                    <i class="fa fa-tags fa-fw" aria-hidden="true">
                        <md-tooltip md-direction="top">Tags</md-tooltip>
                    </i>
                </div>
                <div layout="row" layout-wrap>
                    <div ng-repeat="tag in search.selected.tags track by tag"
                         ng-init="tagData = data.system.tags[tag]"
                         class="md-chip-custom"
                         layout="row"
                         layout-align="left center">
                            <img ng-if="tagData.spriteURL.length > 0" ng-src="{{tagData.spriteURL}}" style="margin-right: 4px; max-height: 12px; max-width: 12px;"/>
                            {{tag}}
                    </div>
                </div>
            </div>
            <!--Behavior-->
            <div ng-if="search.selected.behavior.length > 0" layout="row" class="rem0_9Text">
                <div layout="column" style="margin-right: 4px;">
                    <i class="fa fa-cogs fa-fw" aria-hidden="true">
                        <md-tooltip md-direction="top">Unit Behavior</md-tooltip>
                    </i>
                </div>
                <div layout="row">
                    {{search.selected.behavior}}
                </div>
            </div>
            <!-- Stats -->
            <div class="rem1_2Text boldText" layout="row">
                <i class="fa fa-caret-down fa-fw clickable" ng-class="{'fa-rotate-270': !statsExpanded}" ng-click="toggleStatsExpanded()" aria-hidden="true"></i>
                Stats
            </div>
            <!-- Combat stats -->
            <modifiedstatlist ng-if="dictHasKeys(search.selected.stats.combat)" data="search.selected.stats.combat" expanded="statsExpanded" layout="row" layout-wrap></modifiedstatlist>
            <!-- System stats -->
            <modifiedstatlist ng-if="dictHasKeys(search.selected.stats.system)" data="search.selected.stats.system" expanded="statsExpanded" layout="row" layout-wrap></modifiedstatlist>
            <!-- Regular stats -->
            <modifiedstatlist ng-if="dictHasKeys(search.selected.stats.general)" data="search.selected.stats.general" expanded="statsExpanded" layout="row" layout-wrap></modifiedstatlist>
            <!-- Statuses -->
            <div ng-if="search.selected.statusConditions.length > 0" layout="row">
                <div layout="row" style="margin-right: 4px; padding-top: 5px;">
                    <i class="fa fa-medkit fa-fw" aria-hidden="true">
                        <md-tooltip md-direction="top">{{data.system.interfaceLabels.statusConditions}}</md-tooltip>
                    </i>
                </div>
                <div layout="column" flex="100" style="padding-right: 8px;">
                   <statuscondition ng-repeat="status in search.selected.statusConditions track by $index"
                                    status="status"
                                    sysdata="data.system.statusConditions[status.name]"></statuscondition>
                </div>
            </div>
            <!--Weapon ranks-->
            <div layout="row">
                <div layout="row" style="margin-right: 4px; padding-top: 5px;">
                    <i class="fa fa-tasks fa-fw" aria-hidden="true">
                        <md-tooltip md-direction="top">{{data.system.interfaceLabels.weaponRanks}}</md-tooltip>
                    </i>
                </div>
                <div layout="row" layout-wrap>
                    <div ng-repeat="(type, rank) in search.selected.weaponRanks track by type" class="md-chip-custom">{{type}}<span ng-if="rank.length > 0"> - {{rank}}</span></div>
                </div>
            </div>
            <md-divider></md-divider>
            <!-- Inventory -->
            <div class="rem1_2Text boldText" layout="row">
                <i class="fa fa-caret-down fa-fw clickable" ng-class="{'fa-rotate-270': !invExpanded}" ng-click="toggleInvExpanded()" aria-hidden="true"></i>
                {{data.system.interfaceLabels.inventory}}
            </div>
            <div layout="column" ng-if="invExpanded">
                <!--Inventory Subsections-->
                <div ng-repeat="subsection in search.selected.inventory.subsections track by $index" ng-class="{'bottomMargin': !$last}">
                    <div ng-if="data.system.interfaceLabels.inventorySubsections.length >= $index">
                        {{data.system.interfaceLabels.inventorySubsections[$index]}}
                    </div>
                    <inventoryitem ng-repeat="item in subsection.items track by $index"  
                               item="item"
                               sysdata="data.system.items[item.name]"
                               skillsysdata="data.system.skills"
                               tagsysdata="data.system.tags"
                               engravingsysdata="data.system.engravings">
                    </inventoryitem>
                    <md-card ng-if="subsection.emptySlotCount > 0"
                            class="md-card-hover verticalPadding horizontalPadding"
                            layout="column">
                            <div layout="row" layout-align="space-between start" class="opacity50">
                                <div layout="column">
                                    <div layout="row" layout-align="left center">
                                        <i layout="row" layout-align="start center">Empty x{{subsection.emptySlotCount}}</i>
                                    </div>
                                </div>
                            </div>
                    </md-card>
                </div>
                <!-- Combat Arts -->
                <div ng-if="search.selected.combatArts.length > 0" class="topMargin">
                    <div class="leftMargin topMargin boldText" layout="row">
                        {{data.system.interfaceLabels.combatArts}}
                    </div>
                    <combatart ng-repeat="art in search.selected.combatArts track by $index"  
                               combatart="art"
                               sysdata="data.system.combatArts[art]"
                               tagsysdata="data.system.tags">
                    </combatart>
                </div>
            </div>
            <md-divider></md-divider>
            <!--Emblem-->
            <div ng-if="search.selected.emblem">
                <div class="rem1_2Text boldText" layout="row">
                    <i class="fa fa-caret-down fa-fw clickable" ng-class="{'fa-rotate-270': !emblemExpanded}" ng-click="toggleEmblemExpanded()" aria-hidden="true"></i>
                    {{data.system.interfaceLabels.emblem}}
                </div>
                <div layout="column" ng-if="emblemExpanded">
                    <emblem emblem="search.selected.emblem" 
                            sysdata="data.system.emblems[search.selected.emblem.name]" 
                            skillsysdata="data.system.skills"
                            itemsysdata="data.system.items"
                            tagsysdata="data.system.tags"
                            engravingsysdata="data.system.engravings"
                            engageattacksysdata="data.system.engageAttacks"></emblem>
                </div>
            </div>
            <md-divider ng-if="search.selected.emblem"></md-divider>
            <!--Battalion-->
            <div ng-if="search.selected.battalion">
                <div class="rem1_2Text boldText" layout="row">
                    {{data.system.interfaceLabels.battalion}}
                </div>
                <div layout="column">
                    <battalion battalion="search.selected.battalion" 
                               battalionsysdata="data.system.battalions[search.selected.battalion.name]" 
                               gambitsysdata="data.system.gambits[search.selected.battalion.gambitName]"
                               battalionlabel="data.system.interfaceLabels.battalion"
                               gambitlabel="data.system.interfaceLabels.gambit"
                    ></battalion>
                </div>
                <md-divider></md-divider>
            </div>
            <!--Skills-->
            <div ng-if="search.selected.hasSkills">
                <div class="rem1_2Text boldText" layout="row">
                    <i class="fa fa-caret-down fa-fw clickable" ng-class="{'fa-rotate-270': !skillsExpanded}" ng-click="toggleSkillsExpanded()" aria-hidden="true"></i>
                    {{data.system.interfaceLabels.skills}}
                </div>
                <div layout="column" ng-if="skillsExpanded">
                    <div ng-repeat="subsection in search.selected.skillSubsections track by $index" ng-if="subsection.skills.length > 0" class="topMargin">
                        <div ng-if="data.system.interfaceLabels.skillSubsections.length >= $index">
                            {{data.system.interfaceLabels.skillSubsections[$index]}}
                        </div>
                        <skill ng-repeat="skill in subsection.skills track by $index"
                               skill="skill"
                               sysdata="data.system.skills[skill.name]"
                               expanded="true"
                               active="true">
                        </skill>
                    </div>
                </div>
            </div>
            <md-divider ng-if="search.selected.hasSkills"></md-divider>
            <!--Adjutants-->
            <div ng-if="search.selected.adjutants.length > 0">
                <div class="rem1_2Text boldText" layout="row">
                    <i class="fa fa-caret-down fa-fw clickable" ng-class="{'fa-rotate-270': !adjutantsExpanded}" ng-click="toggleAdjutantsExpanded()" aria-hidden="true"></i>
                    {{data.system.interfaceLabels.adjutants}}
                </div>
                <div layout="column" ng-if="adjutantsExpanded">
                    <adjutant ng-repeat="adjutant in search.selected.adjutants track by $index"  
                              adjutant="adjutant"
                              sysdata="data.system.adjutants[adjutant]">
                    </adjutant>
                </div>
                <md-divider></md-divider>
            </div>
        </md-content>
    </div>
    <!-- Tile display -->
    <div id="divTileDisplay" ng-show="displayTile" layout="column" class="verticalPadding horizontalPadding slide" style="width: 375px; height: 100%;">
        <md-content ng-if="selectedTile" class="horizontalPadding">
            <div layout="row" layout-align="left center" class="rem1_4Text boldText bottomMargin">
                <!--Tile preview-->
                <div ng-style="{'background-image': 'url({{data.map.mapImageURL}})', 'background-position': 'left -'+((data.map.constants.tileSize + data.map.constants.tileSpacing)*(selectedTile.coordinate.x-(data.map.constants.hasHeaderTopLeft ? 0 : 1)))+'px top -'+((data.map.constants.tileSize + data.map.constants.tileSpacing)*(selectedTile.coordinate.y-(data.map.constants.hasHeaderTopLeft ? 0 : 1)))+'px', 'width': (data.map.constants.tileSize + data.map.constants.tileSpacing)+'px', 'height': (data.map.constants.tileSize + data.map.constants.tileSpacing)+'px', 'overflow': hidden}"></div>
                <!--Coords-->
                <span class="leftPadding">Tile {{selectedTile.coordinate.asText}}</span>
            </div>
            <md-divider></md-divider>
            <!-- Occupying Unit -->
            <div layout="row" class="bottomMargin">
                <b>Unit</b>:&nbsp;
                <span ng-if="selectedTile.unitData.occupyingUnitName.length == 0" class="opacity50"><i>None</i></span>
                <span ng-if="selectedTile.unitData.occupyingUnitName.length > 0">
                    {{selectedTile.unitData.occupyingUnitName}}
                    <span ng-if="selectedTile.unitData.location.pairedUnitName.length > 0"> / {{selectedTile.unitData.location.pairedUnitName}}</span>
                </span>
            </div>
            <!-- Terrain Type -->
            <tileterraintype tile="selectedTile" sysdata="data.system.terrainTypes[selectedTile.terrainType]" showtitle="true" layout="column" class="bottomMargin"></tileterraintype>
            <md-divider></md-divider>
            <!-- Tile Objects -->
            <div ng-repeat="tileObjInstID in selectedTile.tileObjectInstanceIDs"
                 ng-init="tileObj = {inst: data.map.tileObjectInstances[tileObjInstID], data: data.system.tileObjects[data.map.tileObjectInstances[tileObjInstID].name]}"
                 layout="column"
                 class="bottomMargin">
                <div layout="row">
                    <span class="boldText">{{tileObj.inst.name}}</span>
                </div>
                <div ng-if="tileObj.inst.hp" layout="row">
                    <!--HP-->
                    <div layout="column" flex="50" class="rem0_9Text horizontalPadding bottomMargin">
                        <div layout="row" layout-align="space-between top">
                            <span>Durability</span>
                            <span>
                                <span>{{tileObj.inst.hp.current}} / </span>
                                <span class="rem0_8Text">{{tileObj.inst.hp.maximum}}</span>
                            </span>
                        </div>
                        <div style="height: 6px;">
                            <tileobjecthealthbar hppercentage="tileObj.inst.hp.percentage" fallbackwidth="150" fallbackheight="6" style="width: 150px; height: 6px;"/>
                        </div>
                        <div ng-if="tileObj.inst.hp.remainingBars > 0" class="rem0_7Text" layout="row" layout-align="end">
                            +{{tileObj.inst.hp.remainingBars}} Bars Remaining
                        </div>
                    </div>
                </div>
                <div layout="row" layout-wrap class="rem0_9Text bottomMargin">
                    <div ng-if="tileObj.data.hpModifier != 0" layout="row" layout-align="space-between" flex="50" class="horizontalPadding">
                        <span>HP</span>
                        <span>
                            <span ng-if="tileObj.data.hpModifier >= 0">+</span>{{tileObj.data.hpModifier}}%
                        </span>
                    </div>
                    <!-- Combat Stat Modifiers -->
                    <div ng-repeat="(stat, val) in tileObj.data.combatStatModifiers" layout="row" layout-align="space-between" flex="50" class="horizontalPadding">
                        <span>{{stat}}</span>
                        <span>
                            <span ng-if="val >= 0">+</span>{{val}}
                        </span>
                    </div>
                    <!-- Stat Modifiers -->
                    <div ng-repeat="(stat, val) in tileObj.data.statModifiers" layout="row" layout-align="space-between" flex="50" class="horizontalPadding">
                        <span>{{stat}}</span>
                        <span>
                            <span ng-if="val >= 0">+</span>{{val}}
                        </span>
                    </div>
                    <!--Range-->
                    <div ng-if="tileObj.data.range.minimum > 0 || tileObj.data.range.maximum > 0" layout="row" layout-align="space-between" flex="50" class="horizontalPadding">
                        <span>Rng</span>
                        <span>{{tileObj.data.range.minimum}}<span ng-if="tileObj.data.range.minimum != tileObj.data.range.maximum">&nbsp;-&nbsp;{{tileObj.data.range.maximum}}</span></span>
                    </div>
                </div>
                <div layout="row" ng-repeat="text in tileObj.data.textFields" class="rem0_9Text leftPadding" ng-class="{'bottomMargin': !$last}">
                    {{text}}
                </div>
            </div>
        </md-content>
    </div>
    <!-- Dice roll display -->
    <div id="divDiceDisplay" ng-show="displayDice" layout="column" class="verticalPadding doubleHorizontalPadding slide" style="width: 375px; height: 100%;">
        <div layout="row" layout-align="left center" class="rem1_4Text boldText topMargin bottomMargin">
            <span class="material-symbols-rounded">casino</span>
            <span class="leftPadding">Dice Roller</span>
        </div>
        <md-divider></md-divider>
        <form name="diceRollParmForm" ng-submit="rollDice()">
            <div layout="row" layout-align="start center">
                <md-input-container class="md-block" flex="35">
                    <label>Lowest Value</label>
                    <input required type="number" step="number" name="lowerBound" ng-model="dice.lowerBound" min="1" max="999" ng-change="validateDiceRange()" />
                </md-input-container>
                <md-input-container class="md-block" flex="35">
                    <label>Highest Value</label>
                    <input required type="number" step="number" name="upperBound" ng-model="dice.upperBound" min="2" max="1000" ng-change="validateDiceRange()" />
                </md-input-container>
                <md-input-container class="md-block" flex="30">
                    <label># of Dice</label>
                    <input required type="number" step="number" name="rollCount" ng-model="dice.rollCount" min="1" max="20" />
                </md-input-container>
            </div>
            <div layout="column">
                <md-checkbox ng-model="dice.rollAverages"
                                aria-label="Use Averaged Rolls (True Hit)">
                                Use Averaged Rolls (True Hit)
                </md-checkbox>
                <md-button type="submit" class="md-raised md-primary">
                    <span layout="row" layout-align="center center">
                        Roll Dice&nbsp;<span class="material-symbols-rounded">casino</span>
                    </span>
                </md-button>
            </div>
        </form>
        <md-divider></md-divider>
        <div class="rem1_2Text boldText" layout="row">
            Quick Rolls
        </div>
        <div layout="row">
            <md-button class="md-raised" ng-click="quickRollDice(1,100,1,false)">1 d100</md-button>
            <md-button class="md-raised" ng-click="quickRollDice(1,100,10,false)">10 d100</md-button>
            <md-button class="md-raised" ng-click="quickRollDice(1,100,1,true)">1 d100 Avg.</md-button>
        </div>
        <md-divider></md-divider>
        <div class="rem1_2Text boldText topMargin bottomMargin" layout="row" layout-align="space-between center">
            <span>History</span>
            <div ng-click="clearDiceHistory()" class="clickable">
                <i class="fa fa-eraser fa-fw" aria-hidden="true"><md-tooltip md-direction="left">Clear history</md-tooltip></i>
            </div>
        </div>
        <md-content>
            <div ng-repeat="historyObj in diceHistory">
                <md-card class="verticalPadding horizontalPadding">
                    <div layout="row" layout-align="start start">
                        <div layout="column" flex="30">
                            <div layout="column">
                                <span class="rem0_8Text boldText"># of Dice</span>
                                <span>{{historyObj.rollCount}}</span>
                            </div>
                            <div layout="column" class="topMargin">
                                <span class="rem0_8Text boldText">Bounds</span>
                                <span>{{historyObj.lowerBound}} - {{historyObj.upperBound}}</span>
                            </div>
                        </div>
                        <div layout="column" flex="70">
                            <span class="rem0_8Text boldText">Results</span>
                            <div ng-if="historyObj.rollStyle == 0" layout="row" layout-align="start" layout-wrap>
                                <span ng-repeat="val in historyObj.rolls track by $index" class="horizontalPadding">
                                    {{val}}
                                </span>
                            </div>
                            <div ng-if="historyObj.rollStyle == 1" layout="column">
                                <div layout="row" ng-repeat="val in historyObj.rolls track by $index" ng-class="{'halfBottomMargin': !$last}">
                                    {{val[2]}}&nbsp;<span class="opacity50"> = ({{val[0]}} + {{val[1]}}) / 2</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </md-card>
            </div>
        </md-content>
    </div>
    <!-- Map -->
    <md-content id="mapScollBox" class="backgroundTexture" layout-padding flex>
        <div class="mapBackground"
             ng-style="{'background-image': 'url({{data.map.mapImageURL}})', 'width': data.map.imageWidth + 'px', 'height': data.map.imageHeight + 'px', 'padding-top': data.map.constants.hasHeaderTopLeft ? (data.map.constants.tileSize)+'px' : '0px', 'padding-left': data.map.constants.hasHeaderTopLeft ? (data.map.constants.tileSize)+'px' : '0px'}">
             <!--Draw tiles-->
             <div ng-repeat="row in data.map.tiles track by $index"
                 class="mapRow"
                 ng-style="{'height': data.map.constants.tileSize+'px', 'margin-bottom': data.map.constants.tileSpacing+'px'}">
                <div ng-repeat="tile in row track by $index"
                     class="mapTile"
                     ng-style="{'width': (data.map.constants.tileSize+1)+'px', 'height': (data.map.constants.tileSize+1)+'px', 'margin-right': data.map.constants.tileSpacing+'px'}"
                     title="({{tile.coordinate.asText}}) {{tile.terrainType}} {{tile.unitData.occupyingUnitName.length > 0 ? '['+tile.unitData.occupyingUnitName+(tile.unitData.location.pairedUnitName.length > 0 ? '/'+tile.unitData.location.pairedUnitName : '')+']' : ''}}"
                     ng-mouseover="mapTile_OnMouseover(tile)"
                     ng-mouseout="mapTile_OnMouseout(tile)"
                     ng-click="mapTile_OnClick(tile)"
                     ng-class="{'clickable': tile.unitData.occupyingUnitName.length > 0 || tile.tileObjectInstanceIDs.length > 0, 'inRangeTileObj': tile.tileObjCount > 0, 'inRangeMovColor': tile.movCount > 0, 'inRangeAtkColor': tile.atkCount > 0 && tile.movCount == 0, 'inRangeStaffColor': tile.utilCount > 0 && tile.atkCount == 0 && tile.movCount == 0}"
                >
                    <!-- Draw tile objects -->
                    <div ng-repeat="tileObjInstID in tile.tileObjectInstanceIDs"
                         ng-init="tileObj = {inst: data.map.tileObjectInstances[tileObjInstID], data: data.system.tileObjects[data.map.tileObjectInstances[tileObjInstID].name]}"
                         ng-show="tileObj.inst.anchorCoordinate == tile.coordinate.asText"
                         class="spriteContainer"
                         ng-class="{'pinnedTileObjectShadow': tileObj.inst.pinned}"
                         ng-style="{'width': ((data.map.constants.tileSize + data.map.constants.tileSpacing) * tileObj.data.size)+'px', 'height': ((data.map.constants.tileSize + data.map.constants.tileSpacing) * tileObj.data.size)+'px', 'z-index': tile.coordinate.y + (tileObj.data.layer * 10)}"
                         layout="row"
                         layout-align="center center">
                         
                        <img ng-src="{{tileObj.data.spriteURL}}" />
                        <tileobjecthealthbar ng-if="tileObj.inst.hp" hppercentage="tileObj.inst.hp.percentage" fallbackwidth="((tileconsts.tileSize + tileconsts.tileSpacing) * tileObj.data.size) - 3" fallbackheight="3" class="unitHealthBarPosition" />
                    </div>

                    <!--Draw unit-->
                    <div ng-if="tile.unitData.isUnitAnchor"
                         ng-init="unit = getUnitByName(tile.unitData.occupyingUnitName)"
                         class="spriteContainer"
                         ng-style="{'width': ((data.map.constants.tileSize + data.map.constants.tileSpacing) * unit.location.unitSize)+'px', 'height': ((data.map.constants.tileSize + data.map.constants.tileSpacing) * unit.location.unitSize)+'px', 'z-index': tile.coordinate.y + unit.location.unitSize}"
                         layout="row"
                         layout-align="center end"
                    >
                        <unit ng-if="unit.location.pairedUnit.length > 0"
                              unit="getUnitByName(unit.location.pairedUnit)"
                              tileconsts="data.map.constants"
                              affiliationsysdata="data.system.affiliations"
                              statussysdata="data.system.statusConditions"
                              tagsysdata="data.system.tags"
                              layout="row"
                              layout-align="center end"
                              class="spriteContainer pairSpriteBack"
                        ></unit>
                        <unit unit="unit"
                              tileconsts="data.map.constants"
                              affiliationsysdata="data.system.affiliations"
                              statussysdata="data.system.statusConditions"
                              tagsysdata="data.system.tags"
                              layout="row"
                              layout-align="center end"
                              class="spriteContainer"
                              ng-class="{'pairSpriteFront': unit.location.pairedUnit.length > 0}"
                        ></unit>
                    </div>

                    <div ng-if="displayTileCoordinates"
                        class="spriteContainer highlightedColor lowCostShadowedText noTextSelection"
                        ng-style="{'width': (data.map.constants.tileSize + data.map.constants.tileSpacing)+'px', 'height': (data.map.constants.tileSize + data.map.constants.tileSpacing)+'px', 'font-size': tileCoordinatesFontSize+'px', 'z-index': tile.coordinate.y + 11}"
                        layout="row"
                        layout-align="center center"
                    >
                    {{tile.coordinate.asText}}
                   </div>

                    <div id="{{tile.coordinate.asText}}_hover" 
                         class="mapTileHover breathe" 
                         style="display:none"></div>
                    
                </div>
            </div>
        </div>
    </md-content>
</div>
